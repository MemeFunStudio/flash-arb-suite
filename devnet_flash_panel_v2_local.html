<!doctype html><html lang="en"><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Solana Devnet Control Panel — Flash Executor (v2 local-vendor)</title>
<style>:root{--bg:#0f1221;--card:#171a2e;--ink:#e8eaf6;--muted:#9aa3b2;--acc:#7aa2ff}*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--ink);font:14px ui-sans-serif,system-ui,Segoe UI,Roboto,Arial}.wrap{max-width:1100px;margin:0 auto;padding:24px}.card{background:var(--card);border:1px solid #242845;border-radius:14px;padding:16px;margin:12px 0}.row{display:grid;grid-template-columns:1fr 1fr;gap:18px}input,select,textarea,button{width:100%;padding:10px;border-radius:10px;border:1px solid #2b2f4a;background:#0d1022;color:var(--ink)}button{cursor:pointer;background:#1b2040}.mono{font-family:ui-monospace,Menlo,Consolas,monospace}.tx{border-left:3px solid #2f3563;padding-left:10px;margin:8px 0}.small{font-size:12px;color:#96a0b8}.hr{height:1px;background:#262a45;margin:14px 0}</style>
<div class="wrap">
<h1>⚡ Flash Executor — Devnet Control Panel <span class="mono" style="padding:4px 8px;border:1px solid #22284d;border-radius:999px;background:#0b0f24">LOCAL vendor</span></h1>
<p class="small" id="banner">Imports from <code>./vendor/*.mjs</code> — no CDNs required.</p>
<div class="card"><div class="row"><div><label>RPC</label><div style="display:flex;gap:8px"><select id="rpc"><option>https://api.devnet.solana.com</option></select><button id="ping">Ping</button></div><div class="small">Status: <span id="rpcStatus" class="mono">—</span></div></div><div><label>Program ID</label><input id="programId" class="mono" value="9ckBy54vd9G6FmR63Z4PoLtNq8rbtoYzhVbJGx458Kmn"/><div class="small">Loaded from your contract: <span class="mono">declare_id!(…)</span></div></div></div><div class="hr"></div><div class="row"><div><button id="connect">Connect Phantom</button><div class="small">Wallet: <span id="wallet" class="mono">—</span></div></div><div><div style="display:flex;gap:8px"><button id="airdrop">Airdrop 1 SOL</button><button id="balance">Refresh Balance</button></div><div class="small">Balance: <span id="bal" class="mono">—</span></div></div></div></div>
<h2>1) Global Config</h2>
<div class="card"><div class="row"><div><label>Existing Global (optional)</label><input id="globalAddr" class="mono" placeholder="Paste address if already created"/><div style="display:flex;gap:8px;margin-top:8px"><button id="fetchGlobal">Fetch</button><button id="downloadGlobal">Download Global Keypair</button></div><div class="small">Owner (from Global): <span id="globalOwner" class="mono">—</span></div></div><div><label>Create New Global</label><div style="display:flex;gap:8px"><button id="createGlobal">Generate Keypair</button><button id="initGlobal">Initialize On-Chain</button></div><div class="small">New Global Addr: <span id="newGlobalAddr" class="mono">—</span></div></div></div><div class="hr"></div><div class="row"><div><label>Add/Remove Executor</label><input id="execKey" class="mono" placeholder="Executor pubkey"/><div style="display:flex;gap:8px;margin-top:8px"><button id="addExec">Add</button><button id="removeExec">Remove</button></div></div><div><label>DEX Program Whitelist</label><input id="dexProg" class="mono" placeholder="DEX program id (e.g. Raydium/Orca)"/><div style="display:flex;gap:8px;margin-top:8px"><button id="addDex">Add</button><button id="removeDex">Remove</button></div></div></div></div>
<h2>2) Pool & Vault</h2>
<div class="card"><div class="row"><div><label>Mint</label><input id="mint" class="mono" placeholder="Token mint (devnet)"/><div class="small">Token Program: <span id="whichTokenProg" class="mono">—</span></div></div><div><label>Pool Params</label><div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px"><div><input id="minBps" type="number" value="30"/><div class="small">min_profit_bps</div></div><div><label><input id="poolEnabled" type="checkbox" checked/> enabled</label></div><div><button id="derivePdas">Derive PDAs</button></div></div><div class="small">Pool PDA: <span id="poolPda" class="mono">—</span></div><div class="small">Vault Authority PDA: <span id="vaultAuth" class="mono">—</span></div><div class="small">Vault ATA: <span id="vaultAta" class="mono">—</span></div></div></div><div class="hr"></div><div class="row"><div><label>Vault</label><div style="display:flex;gap:8px"><button id="createVaultAta">Create Vault ATA</button><button id="vaultBal">Vault Balance</button></div><div class="small">Vault Amount: <span id="vaultAmount" class="mono">—</span></div></div><div><label>Create / Update Pool</label><div style="display:flex;gap:8px"><button id="createPool">Create Pool</button><button id="setPool">Set Params</button></div></div></div></div>
<h2>3) Execute Route</h2>
<div class="card"><div class="row"><div><label>Principal (u64 base units)</label><input id="principal" class="mono" value="1000000"/></div><div><label>Compute Budget</label><div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px"><div><input id="cuLimit" type="number" value="1200000"/><div class="small">units</div></div><div><input id="cuPrice" type="number" value="0"/><div class="small">microlamports</div></div><div><button id="execute">Execute Route</button></div></div></div></div><div class="hr"></div><label>Route JSON</label><textarea id="route" class="mono" placeholder='[{"programId":"DEX_PROGRAM_ID","metas":[{"pubkey":"...","isSigner":false,"isWritable":true}],"data":"hex-encoded-cpi-data"}]'></textarea></div>
<h2>4) DEX Program Verifier</h2>
<div class="card"><label>Program IDs (one per line)</label><textarea id="dexList" class="mono" placeholder="whirLbMiicVdio4qvUfM5KAg6Ct8VwpYzGff3uctyCc&#10;675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"></textarea><div style="display:flex;gap:8px;margin-top:8px"><button id="verifyDex">Verify on-chain</button></div><div class="small">Results: <span id="dexResults" class="mono">—</span></div></div>
<h2>TX Log</h2><div class="card" id="log"></div></div>
<script type="module">
import * as web3 from "./vendor/web3.js";
import * as spl from "./vendor/spl-token.mjs";
import { sha256 as _sha256 } from "./vendor/js-sha256.js";
const $=id=>document.getElementById(id);const logDiv=$('log');const log=(m,ok=true)=>{const el=document.createElement('div');el.className='tx';el.innerHTML=ok?m:'<span style="color:#ff5d5d">'+m+'</span>';logDiv.prepend(el);};
function exLink(sig){return `<a class="mono" target="_blank" href="https://explorer.solana.com/tx/${sig}?cluster=devnet">${sig}</a>`;}function addrLink(pk){return `<a class="mono" target="_blank" href="https://explorer.solana.com/address/${pk}?cluster=devnet">${pk}</a>`;}
let conn=new web3.Connection($('rpc').value,{commitment:'confirmed'});let programId=new web3.PublicKey($('programId').value);let wallet=null;
function provider(){return(window.phantom&&window.phantom.solana)?window.phantom.solana:((window.solana&&window.solana.isPhantom)?window.solana:null);}
$('ping').onclick=async()=>{try{$('rpcStatus').textContent='ok '+JSON.stringify(await conn.getVersion())}catch(e){$('rpcStatus').textContent='error';log('RPC error: '+e.message,false)}};
$('programId').addEventListener('input',e=>{try{programId=new web3.PublicKey(e.target.value.trim())}catch{}});
$('connect').onclick=async()=>{try{const p=provider();if(!p)throw new Error('Phantom not detected');const r=await p.connect({onlyIfTrusted:false});wallet=new web3.PublicKey(r.publicKey.toString());$('wallet').innerHTML=addrLink(wallet.toBase58());const lam=await conn.getBalance(wallet);$('bal').textContent=(lam/1e9).toFixed(4)+' SOL';log('Wallet connected.')}catch(e){log('Connect failed: '+e.message,false)}};
$('balance').onclick=async()=>{if(!wallet)return;const lam=await conn.getBalance(wallet);$('bal').textContent=(lam/1e9).toFixed(4)+' SOL';};
$('airdrop').onclick=async()=>{try{if(!wallet)throw new Error('Connect wallet first');const sig=await conn.requestAirdrop(wallet,1e9);await conn.confirmTransaction(sig,'confirmed');const lam=await conn.getBalance(wallet);$('bal').textContent=(lam/1e9).toFixed(4)+' SOL';log('Airdrop tx: '+exLink(sig));}catch(e){log('Airdrop failed: '+e.message,false)}};
const sha=(s)=>(_sha256.array(s));const u8=n=>Uint8Array.of(n&255);const u16=n=>new Uint8Array([n&255,(n>>8)&255]);const u32=n=>new Uint8Array([n&255,(n>>8)&255,(n>>16)&255,(n>>24)&255]);
function u64(n){const b=BigInt(n);const a=new Uint8Array(8);let x=b;for(let i=0;i<8;i++){a[i]=Number(x&0xffn);x>>=8n;}return a;}
const pkb=k=>new web3.PublicKey(k).toBytes();function cat(...a){let L=0;for(const x of a)L+=x.length;const o=new Uint8Array(L);let i=0;for(const x of a){o.set(x,i);i+=x.length;}return o;}
const vec=b=>cat(u32(b.length),b);const encMeta=m=>cat(pkb(m.pubkey),u8(m.isSigner?1:0),u8(m.isWritable?1:0));
function encVec(items,enc){const parts=items.map(enc);let len=0;for(const p of parts)len+=p.length;const buf=new Uint8Array(len);let off=0;for(const p of parts){buf.set(p,off);off+=p.length;}return cat(u32(items.length),buf);}
function hex(h){const s=(h||'').replace(/^0x/,'').trim();if(!s)return new Uint8Array();if(s.length%2)throw new Error('hex even');const out=new Uint8Array(s.length/2);for(let i=0;i<out.length;i++)out[i]=parseInt(s.slice(2*i,2*i+2),16);return out;}
const disc=n=>Uint8Array.from(sha('global:'+n).slice(0,8));const encIx=ix=>cat(pkb(ix.programId),encVec(ix.metas||[],encMeta),vec(hex(ix.data||'')));const encRoute=r=>encVec(r,encIx);
const {getAssociatedTokenAddress,createAssociatedTokenAccountInstruction,ASSOCIATED_TOKEN_PROGRAM_ID,TOKEN_PROGRAM_ID,TOKEN_2022_PROGRAM_ID}=spl;
async function tokenProgForMint(m){const a=await conn.getAccountInfo(m);if(!a)throw new Error('Mint not found');const o=a.owner.toBase58();if(o===TOKEN_2022_PROGRAM_ID.toBase58()){$('whichTokenProg').textContent='Token-2022';return TOKEN_2022_PROGRAM_ID;}$('whichTokenProg').textContent='Token (legacy)';return TOKEN_PROGRAM_ID;}
const poolPda=(mint,owner)=>web3.PublicKey.findProgramAddressSync([Buffer.from('pool'),mint.toBytes(),owner.toBytes()],programId)[0];
const vaultAuthPda=pool=>web3.PublicKey.findProgramAddressSync([Buffer.from('vault_auth'),pool.toBytes()],programId)[0];
let C={pool:null,vAuth:null,ata:null,tokenProg:null};
$('derivePdas').onclick=async()=>{try{const p=provider();const owner=new web3.PublicKey(p.publicKey.toString());const mint=new web3.PublicKey($('mint').value.trim());const tp=await tokenProgForMint(mint);C.tokenProg=tp;const pool=poolPda(mint,owner);const vA=vaultAuthPda(pool);const ata=await getAssociatedTokenAddress(mint,vA,true,tp,ASSOCIATED_TOKEN_PROGRAM_ID);C.pool=pool;C.vAuth=vA;C.ata=ata;$('poolPda').textContent=pool.toBase58();$('vaultAuth').textContent=vA.toBase58();$('vaultAta').textContent=ata.toBase58();log('Derived PDAs.');}catch(e){log('derivePdas failed: '+e.message,false)}};
async function sendIx(ix,extra=[]){const p=provider();const fp=new web3.PublicKey(p.publicKey.toString());const tx=new web3.Transaction().add(ix);const {blockhash,lastValidBlockHeight}=await conn.getLatestBlockhash();tx.recentBlockhash=blockhash;tx.feePayer=fp;if(extra.length)tx.partialSign(...extra);const signed=await p.signTransaction(tx);const sig=await conn.sendRawTransaction(signed.serialize(),{skipPreflight:false});await conn.confirmTransaction({signature:sig,blockhash,lastValidBlockHeight},'confirmed');return sig;}
$('createVaultAta').onclick=async()=>{try{if(!C.ata)throw new Error('Derive PDAs first');const mint=new web3.PublicKey($('mint').value.trim());const ix=createAssociatedTokenAccountInstruction(new web3.PublicKey(provider().publicKey.toString()),C.ata,C.vAuth,mint,ASSOCIATED_TOKEN_PROGRAM_ID,C.tokenProg);const sig=await sendIx(ix);log('Create Vault ATA: '+exLink(sig));}catch(e){if(String(e).includes('already in use'))log('Vault ATA already exists (ok).');else log('createVaultAta failed: '+e.message,false)}};
$('vaultBal').onclick=async()=>{try{if(!C.ata)throw new Error('Derive PDAs first');const acc=await conn.getTokenAccountBalance(C.ata);$('vaultAmount').textContent=acc?.value?.amount??'0';}catch(e){log('vaultBal failed: '+e.message,false)}};
$('createPool').onclick=async()=>{try{const g=new web3.PublicKey($('globalAddr').value.trim());const owner=new web3.PublicKey(provider().publicKey.toString());const mint=new web3.PublicKey($('mint').value.trim());const min=parseInt($('minBps').value,10)||0;if(!C.pool||!C.vAuth||!C.ata)throw new Error('Derive PDAs first');const data=new Uint8Array([...disc('create_pool'),...u16(min)]);const keys=[{pubkey:g,isSigner:false,isWritable:true},{pubkey:C.pool,isSigner:false,isWritable:true},{pubkey:owner,isSigner:true,isWritable:true},{pubkey:mint,isSigner:false,isWritable:false},{pubkey:C.vAuth,isSigner:false,isWritable:false},{pubkey:C.ata,isSigner:false,isWritable:true},{pubkey:C.tokenProg,isSigner:false,isWritable:false},{pubkey:web3.SystemProgram.programId,isSigner:false,isWritable:false}];const ix=new web3.TransactionInstruction({programId,keys,data});const sig=await sendIx(ix);log('Create Pool: '+exLink(sig));}catch(e){log('createPool failed: '+e.message,false)}};
$('setPool').onclick=async()=>{try{const g=new web3.PublicKey($('globalAddr').value.trim());const min=parseInt($('minBps').value,10)||0;const en=$('poolEnabled').checked;if(!C.pool)throw new Error('Derive PDAs first');const data=new Uint8Array([...disc('set_pool_params'),...u16(min),...(en?Uint8Array.of(1):Uint8Array.of(0))]);const keys=[{pubkey:g,isSigner:false,isWritable:true},{pubkey:C.pool,isSigner:false,isWritable:true},{pubkey:new web3.PublicKey(provider().publicKey.toString()),isSigner:true,isWritable:true}];const ix=new web3.TransactionInstruction({programId,keys,data});const sig=await sendIx(ix);log('Set Pool Params: '+exLink(sig));}catch(e){log('setPool failed: '+e.message,false)}};
$('execute').onclick=async()=>{try{if(!C.pool||!C.vAuth||!C.ata)throw new Error('Derive PDAs first');const principal=BigInt($('principal').value.trim());let route;try{route=JSON.parse(($('route').value||'[]').trim());}catch{throw new Error('Invalid JSON')}if(!Array.isArray(route))throw new Error('Route must be an array');const data=cat(disc('execute_route'),u64(principal),encRoute(route));const keys=[{pubkey:new web3.PublicKey($('globalAddr').value.trim()),isSigner:false,isWritable:true},{pubkey:C.pool,isSigner:false,isWritable:true},{pubkey:C.vAuth,isSigner:false,isWritable:false},{pubkey:C.ata,isSigner:false,isWritable:true},{pubkey:new web3.PublicKey(provider().publicKey.toString()),isSigner:true,isWritable:true},{pubkey:C.tokenProg,isSigner:false,isWritable:false}];for(const k of keys.slice(0))keys.push({...k});for(const step of route){keys.push({pubkey:new web3.PublicKey(step.programId),isSigner:false,isWritable:false});for(const m of (step.metas||[]))keys.push({pubkey:new web3.PublicKey(m.pubkey),isSigner:!!m.isSigner,isWritable:!!m.isWritable});}const lim=parseInt($('cuLimit').value,10)||0;const price=parseInt($('cuPrice').value,10)||0;const tx=new web3.Transaction();if(lim>0)tx.add(web3.ComputeBudgetProgram.setComputeUnitLimit({units:lim}));if(price>0)tx.add(web3.ComputeBudgetProgram.setComputeUnitPrice({microLamports:price}));const ix=new web3.TransactionInstruction({programId,keys,data});tx.add(ix);const p=provider();const {blockhash,lastValidBlockHeight}=await conn.getLatestBlockhash();tx.recentBlockhash=blockhash;tx.feePayer=new web3.PublicKey(p.publicKey.toString());const signed=await p.signTransaction(tx);const sig=await conn.sendRawTransaction(signed.serialize(),{skipPreflight:false});await conn.confirmTransaction({signature:sig,blockhash,lastValidBlockHeight},'confirmed');log('Execute Route: '+exLink(sig));}catch(e){log('execute failed: '+e.message,false)}};
$('verifyDex').onclick=async()=>{try{const list=$('dexList').value.split(/[\r\n]+/).map(s=>s.trim()).filter(Boolean);if(!list.length){$('dexResults').textContent='No program IDs provided.';return}const out=[];for(const id of list){try{const info=await conn.getAccountInfo(new web3.PublicKey(id));if(!info){out.push(id+': NOT FOUND');continue}out.push(`${id}: owner=${info.owner.toBase58()} executable=${info.executable} lamports=${info.lamports}`);}catch(e){out.push(`${id}: ERROR ${e.message}`)}}$('dexResults').innerText=out.join('\\n');}catch(e){$('dexResults').innerText='Verifier failed: '+e.message;}
</script></html>
